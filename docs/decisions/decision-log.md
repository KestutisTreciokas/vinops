# Decision Log — vinops-tg-bot

Фиксирует жёсткие решения. Менять — только отдельной миграцией.

| ID   | Дата (Warsaw)    | Область     | Формулировка                                                   | Альтернативы                 | Критерии/факторы                | Последствия                            | Правила миграции                           |
|------|------------------|-------------|----------------------------------------------------------------|------------------------------|----------------------------------|-----------------------------------------|--------------------------------------------|
| D-001| 2025-10-03 00:00 | Домены      | WEBAPP_BASE_URL = https://miniapp.vinops.online               | Поддомен главного сайта      | Изоляция, CSP, простая маршрутизация | Отдельный TLS/CF                        | Отдельный MS при смене домена               |
| D-002| 2025-10-03 00:00 | Техстек     | Бот: Node.js 20 + grammY                                      | Telegraf, aiogram            | TS-экосистема, стабильность      | Требуется Node 20                       | Миграция вне MVP                            |
| D-003| 2025-10-03 00:00 | Секреты     | sops/age для всех секретов                                     | Vault, 1P                    | GitOps, простота                 | Хранить age-ключ надёжно               | Обновить `.sops.yaml`, пере-зашифровать     |
| D-004| 2025-10-03 00:00 | Сеть        | tg-bot слушает 127.0.0.1:8091 за Caddy                         | Публичный порт               | Безопасность                     | Требует прокси                          | Менять через отдельный MS + синтетика       |
| D-005| 2025-10-03 00:00 | Алертинг    | Отдельный alert-bot для критических событий                    | Встроенные уведомления       | Разделение обязанностей          | Второй токен, второй процесс            | Сведение в админку — отдельный спринт       |
| D-006| 2025-10-03 00:00 | Ключи sops  | Путь age-ключа: `/srv/vinops/age/keys.txt` (0600, root-owned)  | Иные пути                    | Предсказуемость, аудит           | Ops-процедуры ротации                   | Миграция: обновить путь и перевыпустить     |

