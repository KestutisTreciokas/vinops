# Agents Policy — vinops

## Роли
- Strateg/Planner → нормализует требование в ADR/план.
- Implementer → генерирует микро-патчи (или крупные — при соблюдении лимитов и Gate).
- Reviewer/Fixer → доводит CI до зелёного (анализ логов, точечные фиксы).
- Integrator → проверяет статусы/политику, ставит в merge-queue.
- Release Orchestrator → вызывает пост-мердж деплой/смоки.
- Observer → собирает метрики и формирует отчёты.

## Гардрейлы
- **Allowed-paths:** см. `/.ai/ALLOWED_AREAS.yaml` (глобально all, но чувствительные зоны через Gate).
- **Лимиты патчей:** soft 800 строк/30 файлов; hard 2500/100 — при превышении fail + требование Gate/разбиения.
- **Прямые пуши:** разрешены в `staging` и `bot/**` при зелёном CI; в `main` — только PR.
- **Секреты:** через GitHub Environments; **prod** — только при `PROD_SECRETS_ACCESS`.
- **Нулевой спор:** Diagnostic Prologue обязателен при UNKNOWN/риске, до правок.

## Память/контекст
- Источники истины: SRS/SSOT/ARCH/SEO/CI_CD/TESTING/OBSERVABILITY/ROADMAP (Knowledge Pack).
- Агент обязан ссылаться на документы проекта и не изобретать «с нуля».
- При отсутствии данных → запрос уточнения/создание CR.

## Запросы к владельцу
- Формат в PR-комментарии с YAML-блоком `gate_request` (см. `/.ai/APPROVAL_GATES.yaml`).
- Для инфраструктурных действий (WAF/CF/Firewall) — всегда Gate.

## Аудит
- Любое действие агента → запись в PR/CI-логах + артефакты смоков/деплоя.

