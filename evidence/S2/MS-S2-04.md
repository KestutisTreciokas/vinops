# MS-S2-04 — Rate-limit & Ban: runtime proofs (Europe/Warsaw)

## 1) EN rate-limit (chat_cmds)
**Runtime (reply, i18n `rl.too_many_cmds`):**
[reply text] Too many commands. Please wait 30 s.

**Audit (examples, Warsaw):**
… RATE_LIMIT_HIT {"kind":"chat_cmds","retry":30}

## 2) RU rate-limit (VIN)
**Runtime (reply, i18n `rl.too_many_vin`):**
[reply text] Слишком много проверок VIN. Подождите 60 с.

**Audit (examples, Warsaw):**
… RATE_LIMIT_HIT {"kind":"vin","retry":60}

## 3) Ban mode — only /help is allowed
**Runtime (replies):**
[reply text] Доступно: /start, /help, /lang ru|en, /vin <VIN>.        (i18n: help.available)
[reply text] Доступ запрещён. Свяжитесь с поддержкой. (/help доступна) (i18n: ban.blocked)

**Audit (examples, Warsaw):**
… USER_UNBANNED {"target":9101}
… USER_BANNED  {"target":9101}
… BAN_BLOCK    {}

## 4) Code references
- t('rl.too_many_cmds', { s: … }) — services/tg-bot/bot/src/app.js:110
- t('rl.too_many_vin',  { s: … }) — services/tg-bot/bot/src/app.js:187
- t('help.available')             — services/tg-bot/bot/src/app.js:144
- t('ban.blocked')                — services/tg-bot/bot/src/app.js:100

## 5) Locales include these keys (EN/RU)

## Appendix — fresh runtime extracts (2025-10-04 18:10 CEST)

### RU rate-limit (VIN) — runtime (key rl.too_many_vin)
16:[reply text] Слишком много проверок VIN. Подождите 60 с.

### RU rate-limit — audit (Warsaw)
id	event	at_warsaw	data
135	RATE_LIMIT_HIT	2025-10-04 18:09:59	{"kind": "vin", "retry": 60}
133	RATE_LIMIT_HIT	2025-10-04 17:58:47	{"kind": "chat_cmds", "retry": 30}
132	RATE_LIMIT_HIT	2025-10-04 17:58:47	{"kind": "chat_cmds", "retry": 30}
131	RATE_LIMIT_HIT	2025-10-04 17:58:47	{"kind": "chat_cmds", "retry": 30}
130	RATE_LIMIT_HIT	2025-10-04 17:58:47	{"kind": "chat_cmds", "retry": 30}
129	RATE_LIMIT_HIT	2025-10-04 17:58:47	{"kind": "chat_cmds", "retry": 30}
(6 rows)

### BAN mode — runtime (help.available & ban.blocked)
22:[reply text] Доступно: /start, /help, /lang ru|en, /vin <VIN>.

### BAN mode — audit (Warsaw)
id	event	at_warsaw	data
138	BAN_BLOCK	2025-10-04 18:09:59	{}
137	USER_BANNED	2025-10-04 18:09:59	{"target": 9101}
136	USER_UNBANNED	2025-10-04 18:09:59	{"target": 9101}
118	BAN_BLOCK	2025-10-04 17:36:45	{}
117	USER_BANNED	2025-10-04 17:36:45	{"target": 9101}
116	USER_UNBANNED	2025-10-04 17:36:45	{"target": 9101}
(6 rows)

### BAN blocked — runtime (i18n `ban.blocked`) + audit (Warsaw)
id	event	at_warsaw	data
138	BAN_BLOCK	2025-10-04 18:09:59	{}
137	USER_BANNED	2025-10-04 18:09:59	{"target": 9101}
118	BAN_BLOCK	2025-10-04 17:36:45	{}
117	USER_BANNED	2025-10-04 17:36:45	{"target": 9101}
(4 rows)

## Appendix — RU chat_cmds limit & Ban proofs (2025-10-04 18:28 CEST)

### RU rate-limit (chat_cmds) — runtime (i18n `rl.too_many_cmds`)
28:[reply text] Слишком много команд. Подождите 29 с. (i18n: rl.too_many_cmds)
30:[reply text] Слишком много команд. Подождите 29 с. (i18n: rl.too_many_cmds)
32:[reply text] Слишком много команд. Подождите 29 с. (i18n: rl.too_many_cmds)

### RU rate-limit (chat_cmds) — audit (Warsaw, last 3)
id	event	at_warsaw	data
161	RATE_LIMIT_HIT	2025-10-04 18:27:41	{"kind": "chat_cmds", "retry": 29}
160	RATE_LIMIT_HIT	2025-10-04 18:27:41	{"kind": "chat_cmds", "retry": 29}
159	RATE_LIMIT_HIT	2025-10-04 18:27:41	{"kind": "chat_cmds", "retry": 29}
(3 rows)

### Ban mode — runtime (help.allowed & start.blocked)
16:[reply text] [reply text] Доступно: /start, /help, /lang ru|en, /vin <VIN>.
17:[reply text] [reply text] Доступно: /start, /help, /lang ru|en, /vin <VIN>.
18:[reply text] [reply text] Доступно: /start, /help, /lang ru|en, /vin <VIN>.
19:[reply text] [reply text] Доступно: /start, /help, /lang ru|en, /vin <VIN>.

### Ban mode — audit (Warsaw, last 3)
id	event	at_warsaw	data
138	BAN_BLOCK	2025-10-04 18:09:59	{}
137	USER_BANNED	2025-10-04 18:09:59	{"target": 9101}
136	USER_UNBANNED	2025-10-04 18:09:59	{"target": 9101}
(3 rows)

### BAN blocked — runtime RU (i18n `ban.blocked`) — 2025-10-04 18:32 CEST
```
15:[reply text] Доступ запрещён. Свяжитесь с поддержкой. (/help доступна)
```
